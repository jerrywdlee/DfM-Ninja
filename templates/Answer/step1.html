<% const uid=new Date().getTime(); %>
    <div id="EmailAnswer_step1-<%=uid%>" class="bg-emerald-50 p-6 rounded-xl border border-emerald-100 shadow-inner">
        <div class="grid grid-cols-2 gap-6">
            <div class="flex flex-col">
                <div class="flex items-center justify-between mb-3 px-1">
                    <h4 class="text-[10px] font-black text-emerald-800 uppercase tracking-widest opacity-70">Prompt</h4>
                    <div class="flex gap-1.5 focus-within:ring-0">
                        <button title="ãƒªã‚»ãƒƒãƒˆ"
                            class="text-xs hover:bg-emerald-200/50 p-1.5 rounded-lg transition-all active:scale-90 flex items-center justify-center bg-white/50 border border-emerald-200/50 shadow-sm">ğŸ”„</button>
                        <button title="ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°"
                            class="text-xs hover:bg-emerald-200/50 p-1.5 rounded-lg transition-all active:scale-95 flex items-center justify-center bg-white/50 border border-emerald-200/50 shadow-sm">âš¡ï¸</button>
                    </div>
                </div>
                <textarea name="prompt" data-doubleclick="copy"
                    class="w-full h-[320px] p-4 text-xs font-mono border border-emerald-200 rounded-xl bg-white shadow-sm focus:outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-400/20 transition-all resize-none"
                    placeholder="Prompt goes here..."></textarea>
            </div>
            <div class="flex flex-col">
                <div class="flex items-center justify-between mt-4 mb-3 px-1">
                    <h4 class="text-[10px] font-black text-emerald-800 uppercase tracking-widest opacity-70">å›ç­”æ–‡é¢</h4>
                </div>
                <textarea name="answerText" data-doubleclick="copy"
                    class="w-full h-[320px] p-4 text-xs font-mono border border-emerald-200 rounded-xl bg-white shadow-sm focus:outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-400/20 transition-all resize-none"
                    placeholder=" ... "></textarea>
            </div>
        </div>
        <noscript data-name="prompt">
            ç¾åœ¨ã®ãŠå•ã„åˆã‚ã›å†…å®¹ã¯ä»¥ä¸‹ã§ã™ã€‚
            ```
            {{custStatement}}
            ```

            ä¸Šè¨˜è³ªå•ã®å›ç­”ã¨ã—ã¦ã€ä¸‹è¨˜ã®å›ç­”æ–‡ã®è¡¨ç¾ãŒä¸é©åˆ‡ãªç®‡æ‰€ã‚’ä¿®æ­£ã—ã€èª­ã¿ã‚„ã™ã„ã‚ˆã†ã«ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚
            ã¾ãŸã€æ–‡é¢ã‚’Plain Textã«ã—ã€Code Blockã®ä¸­ã«å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚

            - åŠè§’è‹±æ•°å­—ã®å‰å¾Œã«åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã¯ã‚ã‚‹
            - ãŠå®¢æ§˜åãŒçµ±ä¸€ã—ã¦ã„ã‚‹
            - æŒ¨æ‹¶ã¯ä¸è¦ï¼ˆå®šå‹æ–‡ã‚ã‚Šï¼‰
            - æ„Ÿæƒ…è¡¨ç¾ã¯ä¸è¦ã€ãŸã ã—ãŠå®¢æ§˜ã‚’è¿½åŠã—ã‚ˆã†ã¨ã™ã‚‹æ„Ÿè¦šã¯ã—ãªã„ã“ã¨
            - ã‚±ãƒ¼ã‚¹ã¨é–¢é€£ã—ãªã„å€‹äººæƒ…å ±ç­‰ã¯å«ã¾ã‚Œã¦ã„ãªã„
            - ãŠå®¢æ§˜ã®æ–‡è„ˆã‚’è€ƒæ…®ã—ã¦å›ç­”ã™ã‚‹

            å›ç­”æœ¬æ–‡ï¼š
            ```



            ```
        </noscript>
        <script>
            (function () {
                const divId = '#EmailAnswer_step1-<%=uid%>';
                const $scope = $(divId); // ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ç¯„å›²å†…ã ã‘ã§æ¢ã™
                const $prompt = $scope.find('textarea[name="prompt"]');
                const $answerText = $scope.find('textarea[name="answerText"]');
                const promptText = $scope.find('noscript[data-name="prompt"]').text().trim().replace(/\n +/g, '\n');

                const caseData = window.currentCase;
                const activeStep = caseData?.activeStep;

                if (activeStep && activeStep.prompt) {
                    $prompt.val(activeStep.prompt);
                } else {
                    const renderedPrompt = caseData.render(promptText);
                    $prompt.val(renderedPrompt);
                }
                if (activeStep && activeStep.answerText) {
                    $answerText.val(activeStep.answerText);
                }

                // .on ã§ã¯ãªãã€ç›´æ¥è¦ç´ ã« .click ç­‰ã§ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹
                $scope.find('button[title="ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°"]').off('click').on('click', function () {
                    const promptText = $scope.find('textarea[name="prompt"]').val();
                    const answerTextText = $scope.find('textarea[name="answerText"]').val();

                    const renderedPrompt = caseData.render(promptText);
                    $prompt.val(renderedPrompt);

                    console.log('prompt', renderedPrompt, 'answerText', answerTextText);
                });

                $scope.find('button[title="ãƒªã‚»ãƒƒãƒˆ"]').off('click').on('click', function () {
                    if (!confirm('ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                        return;
                    }

                    // ãƒªã‚»ãƒƒãƒˆã—ãŸã‚‰ã€æ‰‹å‹•ã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
                    $scope.find('textarea[name="prompt"]').val(promptText);
                    // $scope.find('textarea[name="answerText"]').val('');
                });
            })();
        </script>

    </div>