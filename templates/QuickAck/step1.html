<% const uid=new Date().getTime(); %>
    <div id="quick-ack_step1-<%=uid%>" class="bg-emerald-50 p-6 rounded-xl border border-emerald-100 shadow-inner">
        <div class="grid grid-cols-2 gap-6">
            <div class="flex flex-col">
                <div class="flex items-center justify-between mb-3 px-1">
                    <h4 class="text-[10px] font-black text-emerald-800 uppercase tracking-widest opacity-70">Prompt</h4>
                    <div class="flex gap-1.5 focus-within:ring-0">
                        <button title="ãƒªã‚»ãƒƒãƒˆ"
                            class="text-xs hover:bg-emerald-200/50 p-1.5 rounded-lg transition-all active:scale-90 flex items-center justify-center bg-white/50 border border-emerald-200/50 shadow-sm">ğŸ”„</button>
                        <button title="ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°"
                            class="text-xs hover:bg-emerald-200/50 p-1.5 rounded-lg transition-all active:scale-95 flex items-center justify-center bg-white/50 border border-emerald-200/50 shadow-sm">âš¡ï¸</button>
                    </div>
                </div>
                <textarea name="prompt"
                    class="w-full h-[320px] p-4 text-xs font-mono border border-emerald-200 rounded-xl bg-white shadow-sm focus:outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-400/20 transition-all resize-none"
                    placeholder="Prompt goes here..."></textarea>
            </div>
            <div class="flex flex-col">
                <div class="flex items-center justify-between mt-4 mb-3 px-1">
                    <h4 class="text-[10px] font-black text-emerald-800 uppercase tracking-widest opacity-70">Json</h4>
                </div>
                <textarea name="json"
                    class="w-full h-[320px] p-4 text-xs font-mono border border-emerald-200 rounded-xl bg-white shadow-sm focus:outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-400/20 transition-all resize-none"
                    placeholder="{ ... }"></textarea>
            </div>
        </div>
        <noscript data-name="prompt">
            ç¾åœ¨ã®ãŠå•ã„åˆã‚ã›å†…å®¹ã¯ä»¥ä¸‹ã§ã™ã€‚
            ```
            {{custStatement}}
            ```

            ä¸Šè¨˜å†…å®¹ã‚’åˆ†æã—ã€æ¬¡ã®ã‚ˆã†ãªèªè­˜åˆã‚ã›æ–‡ã‚’è¨˜è¼‰ã€ä¾‹:
            ```
            æœ¬ãŠå•ã„åˆã‚ã›ã«ã¤ãã¾ã—ã¦ã¯ã€ä»¥ä¸‹ã®å†…å®¹ã¨ã—ã¦èªè­˜ã—ã¦ãŠã‚Šã¾ã™ã€‚
            ãƒ»â—‹â—‹â—‹â—‹
            ãƒ»â—‹â—‹â—‹â—‹
            èªè­˜ã«ç›¸é•ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã”æŒ‡æ‘˜é ‚ã‘ã¾ã™ã¨å¹¸ã„ã§ã”ã–ã„ã¾ã™ã€‚
            ```

            ä¸‹è¨˜ã®JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
            {
            "detailConfirm": "èªè­˜åˆã‚ã›æ–‡"
            }
        </noscript>
        <script>
            (function () {
                const divId = '#quick-ack_step1-<%=uid%>';
                const $scope = $(divId); // ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ç¯„å›²å†…ã ã‘ã§æ¢ã™
                const $prompt = $scope.find('textarea[name="prompt"]');
                const $json = $scope.find('textarea[name="json"]');
                const promptText = $scope.find('noscript[data-name="prompt"]').text().trim().replace(/\n +/g, '\n');

                const caseData = window.currentCase;
                const activeStep = caseData?.activeStep;

                if (activeStep && activeStep.prompt) {
                    $prompt.val(activeStep.prompt);
                } else {
                    $prompt.val(promptText);
                }
                if (activeStep && activeStep.json) {
                    $json.val(activeStep.json);
                }

                // .on ã§ã¯ãªãã€ç›´æ¥è¦ç´ ã« .click ç­‰ã§ãƒã‚¤ãƒ³ãƒ‰ã™ã‚‹
                $scope.find('button[title="ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°"]').off('click').on('click', function () {
                    const promptText = $scope.find('textarea[name="prompt"]').val();
                    const jsonText = $scope.find('textarea[name="json"]').val();
                    console.log('prompt', promptText, 'json', jsonText);
                });

                $scope.find('button[title="ãƒªã‚»ãƒƒãƒˆ"]').off('click').on('click', function () {
                    if (!confirm('ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                        return;
                    }

                    $scope.find('textarea[name="prompt"]').val(promptText);
                    $scope.find('textarea[name="json"]').val('');
                });
            })();
        </script>

    </div>